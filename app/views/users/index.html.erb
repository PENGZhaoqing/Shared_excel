<div class="container">
  <div class="row">
    <div class="col-sm-3 col-md-3">
      <%= render "users/sidenav" %>

    </div>
    <div class="col-sm-9 col-md-9">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">控制面板</h3>
        </div>
        <div class="panel-body" style="min-height: 450px">

          <h4 class="text-muted">用户管理</h4>
          <hr>

          <ul class="nav nav-tabs">
            <li class=<%= "active" if params[:new]=="true" %>><%= link_to "新增用户", users_path(new: true) %></li>
            <li class=<%= "active" if params[:new]=="false" %>><%= link_to "已有用户", users_path(new: false) %></li>
          </ul>


          <% if params[:new]=="true" %>

              <table class="table table-striped table-hover">
                <thead>
                <tr>
                  <th>姓名</th>
                  <th>公司</th>
                  <th>角色</th>
                  <th></th>
                  <th></th>

                </tr>
                </thead>
                <tbody>
                <% @new_users.each do |user| %>
                    <tr>
                      <td><%= user.name %></td>
                      <td><%= user.company %></td>
                      <td><%= user.role %></td>

                      <% if !params[:new_users_page].blank? %>
                          <td><%= link_to "管理", users_path(new: params[:new], user_id: user.id, new_users_page: params[:new_users_page].to_i), class: 'btn-sm btn-info' %></td>
                      <% else %>
                          <td><%= link_to "管理", users_path(new: params[:new], user_id: user.id), class: 'btn-sm btn-info' %></td>
                      <% end %>
                      <td><%= link_to "删除", user_path(user), method: :delete, class: 'btn-sm btn-danger' %></td>

                    </tr>
                <% end %>
                </tbody>
              </table>

              <%= will_paginate @new_users, :param_name => 'new_users_page',
                                :previous_label => t("前一页"), :next_label => t("后一页"), :inner_window => 1 %>

          <% end %>

          <% if params[:new]=="false" %>

              <table class="table table-striped table-hover">
                <thead>
                <tr>
                  <th>姓名</th>
                  <th>公司</th>
                  <th>角色</th>
                  <th></th>
                  <th></th>

                </tr>
                </thead>
                <tbody>
                <% @users.each do |user| %>
                    <tr>
                      <td><%= user.name %></td>
                      <td><%= user.company %></td>
                      <td><%= user.role %></td>

                      <% if !params[:users_page].blank? %>
                          <td><%= link_to "管理", users_path(new: params[:new], user_id: user.id, users_page: params[:users_page].to_i), class: 'btn-sm btn-info' %></td>
                      <% else %>
                          <td><%= link_to "管理", users_path(new: params[:new], user_id: user.id), class: 'btn-sm btn-info' %></td>
                      <% end %>

                      <td><%= link_to "删除", user_path(user), method: :delete, class: 'btn-sm btn-danger' %></td>

                    </tr>
                <% end %>
                </tbody>
              </table>

              <%= will_paginate @users, :param_name => 'users_page',
                                :previous_label => t("前一页"), :next_label => t("后一页"), :inner_window => 1 %>

          <% end %>



          <% if !@user.nil? %>

              <hr>
              <div class="alert alert-success">

                <h4 class="text-muted">修改用户信息</h4>
                <br>

                <%= form_for @user, html: {class: 'form', role: 'form'} do |f| %>
                    <%= render 'shared/error_messages', :object => @user %>

                    <div class="row">
                      <div class="form-group col-sm-5">
                        <%= f.label "姓名", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-user"></span></div>
                          <%= f.text_field :name, class: 'form-control', placeholder: "输入真实姓名" %>
                        </div>
                      </div>

                      <div class="form-group col-sm-5">
                        <%= f.label "用户名", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-envelope"></span></div>
                          <%= f.email_field :email, class: 'form-control', placeholder: "输入有效的邮箱" %>
                        </div>
                      </div>


                      <div class="form-group col-sm-5">
                        <%= f.label "公司名", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-home"></span></div>
                          <%= f.text_field :company, class: 'form-control', placeholder: "输入公司全称" %>
                        </div>
                      </div>

                      <div class="form-group col-sm-5">
                        <%= f.label "角色", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-eye-open"></span></div>
                          <%= f.select :role, options_for_select(['一般', '高级', '中级']), {}, class: 'form-control' %>
                        </div>
                      </div>

                      <div class="form-group col-sm-5">
                        <%= f.label "密码", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></div>
                          <%= f.password_field :password, class: 'form-control', placeholder: "输入密码" %>
                        </div>
                      </div>

                      <div class="form-group col-sm-5">
                        <%= f.label "确认密码", class: 'control-label' %>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></div>
                          <%= f.password_field :password_confirmation, class: 'form-control', placeholder: "再次输入密码" %>
                        </div>
                      </div>

                      <div class="col-sm-12">
                        <%= f.submit '保存修改', class: "btn btn-success" %>
                      </div>
                    </div>

                <% end %>

              </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


